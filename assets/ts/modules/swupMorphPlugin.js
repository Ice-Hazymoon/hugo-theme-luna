!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).SwupMorphPlugin=t()}(this,function(){function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},e.apply(this,arguments)}const t=e=>String(e).split(".").map(e=>String(parseInt(e||"0",10))).concat(["0","0"]).slice(0,3).join(".");class n{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(e=>e()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([e,n])=>{if(!function(e,n,r){const o=function(e,t){var n;if("swup"===e)return null!=(n=t.version)?n:"";{var r;const n=t.findPlugin(e);return null!=(r=null==n?void 0:n.version)?r:""}}(e,r);return!!o&&((e,n)=>n.every(n=>{const[,r,o]=n.match(/^([\D]+)?(.*)$/)||[];var i,a;return((e,t)=>{const n={"":e=>0===e,">":e=>e>0,">=":e=>e>=0,"<":e=>e<0,"<=":e=>e<=0};return(n[t]||n[""])(e)})((a=o,i=t(i=e),a=t(a),i.localeCompare(a,void 0,{numeric:!0})),r||">=")}))(o,n)}(e,n=Array.isArray(n)?n:[n],this.swup)){const t=`${e} ${n.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${t}`)}}),!0}on(e,t,n={}){var r;t=!(r=t).name.startsWith("bound ")||r.hasOwnProperty("prototype")?t.bind(this):t;const o=this.swup.hooks.on(e,t,n);return this.handlersToUnregister.push(o),o}once(t,n,r={}){return this.on(t,n,e({},r,{once:!0}))}before(t,n,r={}){return this.on(t,n,e({},r,{before:!0}))}replace(t,n,r={}){return this.on(t,n,e({},r,{replace:!0}))}off(e,t){return this.swup.hooks.off(e,t)}}var r,o="undefined"==typeof document?void 0:document,i=!!o&&"content"in o.createElement("template"),a=!!o&&o.createRange&&"createContextualFragment"in o.createRange();function s(e,t){var n,r,o=e.nodeName,i=t.nodeName;return o===i||(n=o.charCodeAt(0),r=i.charCodeAt(0),n<=90&&r>=97?o===i.toUpperCase():r<=90&&n>=97&&i===o.toUpperCase())}function u(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}u(e,t,"selected")},INPUT:function(e,t){u(e,t,"checked"),u(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,i=0,a=e.firstChild;a;)if("OPTGROUP"===(r=a.nodeName&&a.nodeName.toUpperCase()))a=(n=a).firstChild;else{if("OPTION"===r){if(a.hasAttribute("selected")){o=i;break}i++}!(a=a.nextSibling)&&n&&(a=n.nextSibling,n=null)}e.selectedIndex=o}}};function d(){}function c(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}var f=function(e,t,n){if(n||(n={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var u=t;(t=o.createElement("html")).innerHTML=u}else f=(f=t).trim(),t=i?function(e){var t=o.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(f):a?function(e){return r||(r=o.createRange()).selectNode(o.body),r.createContextualFragment(e).childNodes[0]}(f):function(e){var t=o.createElement("body");return t.innerHTML=e,t.childNodes[0]}(f);else 11===t.nodeType&&(t=t.firstElementChild);var f,p=n.getNodeKey||c,h=n.onBeforeNodeAdded||d,m=n.onNodeAdded||d,v=n.onBeforeElUpdated||d,g=n.onElUpdated||d,b=n.onBeforeNodeDiscarded||d,N=n.onNodeDiscarded||d,C=n.onBeforeElChildrenUpdated||d,T=n.skipFromChildren||d,A=n.addChild||function(e,t){return e.appendChild(t)},y=!0===n.childrenOnly,E=Object.create(null),S=[];function w(e){S.push(e)}function x(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var r=void 0;t&&(r=p(n))?w(r):(N(n),n.firstChild&&x(n,t)),n=n.nextSibling}}function U(e,t,n){!1!==b(e)&&(t&&t.removeChild(e),N(e),x(e,n))}function O(e){m(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=p(t);if(r){var o=E[r];o&&s(t,o)?(t.parentNode.replaceChild(o,t),P(o,t)):O(t)}else O(t);t=n}}function P(e,t,n){var r=p(t);if(r&&delete E[r],!n){if(!1===v(e,t))return;if(function(e,t){var n,r,o,i,a=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var s=a.length-1;s>=0;s--)r=(n=a[s]).name,i=n.value,(o=n.namespaceURI)?e.getAttributeNS(o,r=n.localName||r)!==i&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,i)):e.getAttribute(r)!==i&&e.setAttribute(r,i);for(var u=e.attributes,l=u.length-1;l>=0;l--)r=(n=u[l]).name,(o=n.namespaceURI)?t.hasAttributeNS(o,r=n.localName||r)||e.removeAttributeNS(o,r):t.hasAttribute(r)||e.removeAttribute(r)}}(e,t),g(e),!1===C(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,i,a,u,d=T(e),c=t.firstChild,f=e.firstChild;e:for(;c;){for(a=c.nextSibling,n=p(c);!d&&f;){if(i=f.nextSibling,c.isSameNode&&c.isSameNode(f)){c=a,f=i;continue e}r=p(f);var m=f.nodeType,v=void 0;if(m===c.nodeType&&(1===m?(n?n!==r&&((u=E[n])?i===u?v=!1:(e.insertBefore(u,f),r?w(r):U(f,e,!0),f=u):v=!1):r&&(v=!1),(v=!1!==v&&s(f,c))&&P(f,c)):3!==m&&8!=m||(v=!0,f.nodeValue!==c.nodeValue&&(f.nodeValue=c.nodeValue))),v){c=a,f=i;continue e}r?w(r):U(f,e,!0),f=i}if(n&&(u=E[n])&&s(u,c))d||A(e,u),P(u,c);else{var g=h(c);!1!==g&&(g&&(c=g),c.actualize&&(c=c.actualize(e.ownerDocument||o)),A(e,c),O(c))}c=a,f=i}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=p(t))?w(n):U(t,e,!0),t=r}}(e,f,r);var b=l[e.nodeName];b&&b(e,t)}(e,t):l.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var r=p(n);r&&(E[r]=n),e(n),n=n.nextSibling}}(e);var R,q,I=e,M=I.nodeType,V=t.nodeType;if(!y)if(1===M)1===V?s(e,t)||(N(e),I=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(e,(R=t.nodeName,(q=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==q?o.createElementNS(q,R):o.createElement(R)))):I=t;else if(3===M||8===M){if(V===M)return I.nodeValue!==t.nodeValue&&(I.nodeValue=t.nodeValue),I;I=t}if(I===t)N(e);else{if(t.isSameNode&&t.isSameNode(I))return;if(P(I,t,y),S)for(var j=0,k=S.length;j<k;j++){var B=E[S[j]];B&&U(B,B.parentNode,!1)}}return!y&&I!==e&&e.parentNode&&(I.actualize&&(I=I.actualize(e.ownerDocument||o)),e.parentNode.replaceChild(I,e)),I};const p={INPUT:!0,TEXTAREA:!0,SELECT:!0},h={INPUT:!0,TEXTAREA:!0,OPTION:!0},m={"datetime-local":!0,"select-multiple":!0,"select-one":!0,color:!0,date:!0,datetime:!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,textarea:!0,time:!0,url:!0,week:!0},v=[function(e,t){return!(!h[e.tagName]&&e.isEqualNode(t))},function(e,t){const n=e.closest("[data-morph-persist]");if(!n&&p[(r=e).tagName]&&m[r.type]&&e===document.activeElement){const n={value:!0};return Array.from(t.attributes).forEach(t=>{n[t.name]||e.setAttribute(t.name,t.value)}),!1}var r;return!n},function(e,t){return e!==document.activeElement||!e.isContentEditable}];function g(e,t,n){void 0===n&&(n=[]);const r=[...v,...n];return f(e,t,{onBeforeElUpdated:(e,t)=>function(e,t,n){return!n.map(n=>"function"!=typeof n||n(e,t)).includes(!1)}(e,t,r)})}return class extends n{constructor(e){void 0===e&&(e={}),super(),this.name="SwupMorphPlugin",this.requires={swup:">=4"},this.defaults={containers:[],updateCallbacks:[]},this.options=void 0,this.validateContainers=e=>{e.containers=e.containers.filter(e=>!this.options.containers.includes(e))},this.morphContainers=(e,t)=>{let{page:{html:n}}=t;const r=[document,(new DOMParser).parseFromString(n,"text/html")],o=this.getContainers(...r),i=this.options.updateCallbacks||[];for(const{selector:e,outgoing:t,incoming:n}of o)t&&n?g(t,n,i):this.options.containers.includes(e)&&console.warn(`SwupMorphPlugin: No container found for selector: ${e}`)},this.options={...this.defaults,...e}}mount(){this.before("content:replace",this.validateContainers,{priority:1}),this.on("content:replace",this.morphContainers)}getContainers(e,t){return this.getContainerSelectors().map(n=>({selector:n,outgoing:e.querySelector(n),incoming:t.querySelector(n)}))}getContainerSelectors(){const e=this.options.containers,t=((e,t=document)=>Array.from(t.querySelectorAll('[data-swup-morph]:not([data-swup-morph=""])')))().map(e=>`[data-swup-morph='${e.dataset.swupMorph}']`);return this.uniq([...e,...t])}uniq(e){return[...new Set(e)]}}});
//# sourceMappingURL=index.umd.js.map
